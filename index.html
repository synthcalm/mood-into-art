<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIA (Mood Into Art)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #000;
      color: #00FFFF;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: auto;
    }
    .container {
      width: 95%;
      max-width: 500px;
      padding: 20px;
      border: 2px solid #00FFFF;
      border-radius: 12px;
      background-color: rgba(0, 32, 32, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }
    canvas#waveform {
      width: 100%;
      height: 160px;
      background-color: rgba(0, 0, 0, 0.5);
      border: 1px solid #00FFFF;
      margin-bottom: 10px;
    }
    .dot-alert {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: red;
      animation: blink 1s infinite;
      display: none;
      margin-bottom: 10px;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    .footer-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      font-size: 0.9em;
      color: #00FFFF;
      padding: 10px 0;
    }
    textarea, select {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.8);
      border: 2px solid #00FFFF;
      color: #00FFFF;
      margin-bottom: 10px;
      resize: vertical;
    }
    .button-group {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .button {
      background-color: #000;
      border: 2px solid #00FFFF;
      color: #00FFFF;
      padding: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .button:hover {
      background-color: #00FFFF;
      color: #000;
    }
    .button.recording {
      background-color: #FFFF00;
      color: #000;
    }
    #loadingIndicator {
      display: none;
      justify-content: center;
      gap: 4px;
      margin-top: 10px;
    }
    .dot {
      width: 4px;
      height: 4px;
      background-color: #00FFFF;
      border-radius: 50%;
      opacity: 0;
      animation: blink 1.6s infinite;
    }
    .dot:nth-child(1) { animation-delay: 0s; }
    .dot:nth-child(2) { animation-delay: 0.4s; }
    .dot:nth-child(3) { animation-delay: 0.8s; }
    .dot:nth-child(4) { animation-delay: 1.2s; }
    #generatedImage {
      max-width: 100%;
      border: 1px solid #00FFFF;
      margin-top: 20px;
      display: none;
      background: #000;
    }
    #moodHistoryContainer {
      width: 100%;
      margin-top: 20px;
      border: 1px solid #00FFFF;
      padding: 10px;
    }
    #moodHistoryContainer h3 {
      margin-top: 0;
      font-size: 14px;
      text-align: center;
      border-bottom: 1px dashed #00FFFF;
      padding-bottom: 5px;
    }
    .mood-entry {
      font-size: 12px;
      margin-bottom: 5px;
      border-bottom: 1px dashed #00FFFF;
      padding-bottom: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .delete-btn {
      background: none;
      border: none;
      color: #FF0000;
      cursor: pointer;
      font-size: 14px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <canvas id="waveform"></canvas>
    
    <div class="footer-bar">
      <div id="dateTimeDisplay"></div>
      <div id="countdownDisplay">00:30:00</div>
    </div>

    <div class="dot-alert" id="redDot"></div>
    <textarea id="activityInput" rows="4" placeholder="Describe your mood..."></textarea>
    
    <select id="styleSelect">
      <option value="none" selected disabled>Choose Style</option>
      <option value="photo">Hyper-realistic Photo</option>
      <option value="anime">Japanese Anime Style</option>
      <option value="abstract">Abstract</option>
      <option value="surrealism">Surrealism</option>
      <option value="cyberpunk">Cyberpunk</option>
      <option value="calligraphy">Arabic Calligraphy</option>
      <option value="marvel">Marvel Comic</option>
      <option value="art-deco">Art Deco</option>
      <option value="impressionist">Impressionist</option>
      <option value="pop-art">Pop Art</option>
    </select>

    <div class="button-group">
      <button class="button" id="startVoice">Start Voice</button>
      <button class="button" id="redo">Redo</button>
      <button class="button" id="generate">Generate Image</button>
      <button class="button" id="saveImage">Save</button>
    </div>

    <div id="loadingIndicator">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>

    <img id="generatedImage" />
    
    <div id="moodHistoryContainer">
      <h3>Mood Entries</h3>
      <div id="moodHistory"></div>
    </div>
  </div>

  <script>
    // Audio Recording System
    let audioContext, mediaRecorder, audioChunks = [];
    let isRecording = false, countdownInterval;
    const MAX_RECORD_TIME = 30 * 60; // 30 minutes
    let animationId;

    // DOM Elements
    const startVoiceButton = document.getElementById('startVoice');
    const generateButton = document.getElementById('generate');
    const saveButton = document.getElementById('saveImage');
    const activityInput = document.getElementById('activityInput');
    const styleSelect = document.getElementById('styleSelect');
    const waveform = document.getElementById('waveform');
    const waveformCtx = waveform.getContext('2d');

    // Initialize Waveform
    waveform.width = waveform.offsetWidth;
    waveform.height = waveform.offsetHeight;

    // Date/Time Display
    function updateDateTime() {
      const now = new Date();
      document.getElementById('dateTimeDisplay').textContent = 
        `${now.getFullYear()}/${String(now.getMonth()+1).padStart(2,'0')}/${String(now.getDate()).padStart(2,'0')} ` +
        `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Voice Recording
    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          // Handle audio processing here
        };

        mediaRecorder.start();
        isRecording = true;
        startVoiceButton.textContent = 'Stop Voice';
        startVoiceButton.classList.add('recording');
        document.getElementById('redDot').style.display = 'block';
        startCountdown();
        visualizeAudio(stream);
      } catch (err) {
        alert('Microphone access required!');
      }
    }

    function stopRecording() {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        startVoiceButton.textContent = 'Start Voice';
        startVoiceButton.classList.remove('recording');
        document.getElementById('redDot').style.display = 'none';
        clearInterval(countdownInterval);
        cancelAnimationFrame(animationId);
      }
    }

    // Audio Visualization
    function visualizeAudio(stream) {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(stream);
      const analyser = audioContext.createAnalyser();
      
      source.connect(analyser);
      analyser.fftSize = 2048;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);

      function draw() {
        analyser.getByteTimeDomainData(dataArray);
        waveformCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';
        waveformCtx.fillRect(0, 0, waveform.width, waveform.height);
        
        waveformCtx.strokeStyle = '#FFFF00';
        waveformCtx.lineWidth = 2;
        waveformCtx.beginPath();

        const sliceWidth = waveform.width * 1.0 / bufferLength;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
          const v = dataArray[i] / 128.0;
          const y = v * waveform.height / 2;
          
          if (i === 0) waveformCtx.moveTo(x, y);
          else waveformCtx.lineTo(x, y);
          
          x += sliceWidth;
        }

        waveformCtx.stroke();
        animationId = requestAnimationFrame(draw);
      }
      draw();
    }

    // Countdown Timer
    function startCountdown() {
      let seconds = MAX_RECORD_TIME;
      countdownInterval = setInterval(() => {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        document.getElementById('countdownDisplay').textContent = 
          `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        if (seconds-- <= 0) clearInterval(countdownInterval);
      }, 1000);
    }

    // Image Generation
    generateButton.addEventListener('click', async () => {
      if (!activityInput.value.trim() || styleSelect.value === 'none') {
        alert('Please describe your mood and select a style!');
        return;
      }

      const loading = document.getElementById('loadingIndicator');
      const generatedImage = document.getElementById('generatedImage');
      loading.style.display = 'flex';
      
      try {
        // Simulated API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        generatedImage.src = `https://source.unsplash.com/random/800x600/?${styleSelect.value},art`;
        generatedImage.style.display = 'block';
        document.getElementById('beepSound').play();
      } catch (error) {
        alert('Image generation failed: ' + error.message);
      } finally {
        loading.style.display = 'none';
      }
    });

    // Save Functionality
    saveButton.addEventListener('click', () => {
      const image = document.getElementById('generatedImage');
      if (!image.src || image.style.display === 'none') {
        alert('No image to save!');
        return;
      }

      // Save image
      const link = document.createElement('a');
      link.download = 'mood-art.png';
      link.href = image.src;
      link.click();

      // Add to mood history
      const entry = document.createElement('div');
      entry.className = 'mood-entry';
      entry.innerHTML = `
        <span>${new Date().toLocaleDateString('en-CA')} - ${activityInput.value}</span>
        <button class="delete-btn" onclick="this.parentElement.remove()">✕</button>
      `;
      document.getElementById('moodHistory').prepend(entry);
    });

    // Event Listeners
    startVoiceButton.addEventListener('click', () => {
      if (!isRecording) startRecording();
      else stopRecording();
    });

    document.getElementById('redo').addEventListener('click', () => {
      activityInput.value = '';
      styleSelect.value = 'none';
      document.getElementById('generatedImage').style.display = 'none';
    });
  </script>
</body>
</html>
