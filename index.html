<!-- Add this to the <style> section -->
<style>
    /* Fix canvas visibility */
    canvas#grid, canvas#waveform {
        background-color: rgba(0, 0, 0, 0.8);  /* Increased contrast */
    }

    /* Ensure elements are visible */
    #dateDisplay, #countdownDisplay {
        font-size: 12px;  /* Increased font size */
        color: #00FF00 !important;
    }

    /* Fix button visibility */
    .button {
        background-color: #000000;
        border: 2px solid #00FF00 !important;
    }
</style>

<!-- Add this right after opening <body> tag -->
<body>
    <!-- Loading overlay -->
    <div id="initOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; display: flex; justify-content: center; align-items: center; color: #00FF00;">
        Initializing audio system...<br>Click anywhere to start
    </div>

<script>
    // Add this initialization code at the very top of your script
    // ================== CRITICAL FIXES ==================
    // 1. Audio context initialization
    let audioContextInitialized = false;
    
    document.getElementById('initOverlay').addEventListener('click', async () => {
        try {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            await audioContext.resume();
            document.getElementById('initOverlay').style.display = 'none';
            audioContextInitialized = true;
            
            // Initialize grid after audio context
            drawGrid();
            window.dispatchEvent(new Event('resize'));
        } catch (err) {
            alert('Audio system initialization failed: ' + err.message);
        }
    });

    // 2. Modified grid drawing function
    function drawGrid() {
        const grid = document.getElementById('grid');
        const gridCtx = grid.getContext('2d');
        grid.width = grid.clientWidth;
        grid.height = grid.clientHeight;
        
        // Improved grid visibility
        gridCtx.strokeStyle = 'rgba(0, 255, 0, 0.5)'; // Changed to green
        gridCtx.lineWidth = 1; // Thicker lines
        
        // Vertical lines
        for (let i = 0; i <= grid.width; i += 20) {
            gridCtx.beginPath();
            gridCtx.moveTo(i, 0);
            gridCtx.lineTo(i, grid.height);
            gridCtx.stroke();
        }
        
        // Horizontal lines
        for (let j = 0; j <= grid.height; j += 20) {
            gridCtx.beginPath();
            gridCtx.moveTo(0, j);
            gridCtx.lineTo(grid.width, j);
            gridCtx.stroke();
        }
    }

    // 3. Modified waveform drawing
    function drawWaveform() {
        if (!analyser) return;
        
        // Improved waveform visibility
        waveformCtx.strokeStyle = '#00FF00'; // Brighter green
        waveformCtx.lineWidth = 2; // Thicker line
        
        // Rest of your existing waveform code...
    }

    // 4. Add error handling for microphone access
    async function startMic() {
        try {
            if (!audioContextInitialized) {
                alert('Please click the initialization overlay first!');
                return;
            }
            
            // Rest of your existing startMic code...
        } catch (err) {
            alert('Microphone access required! Please allow permissions and try again.');
        }
    }
</script>
