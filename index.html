// DOM elements
const moodForm = document.getElementById('moodForm');
const moodInput = document.getElementById('moodInput');
const imageContainer = document.getElementById('imageContainer');
const styleSelect = document.getElementById('styleSelect');
const dateDisplay = document.getElementById('dateTime');

// Update date display function
function updateDateTime() {
    const now = new Date();
    dateDisplay.textContent = now.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: '2-digit', 
        weekday: 'short' 
    }) + ' ' + now.toLocaleTimeString();
}

// Initialize date/time and set interval for updates
updateDateTime();
setInterval(updateDateTime, 1000);

// Pattern creation helper function
function createPattern(pattern, color) {
    const patterns = {
        'linear': `
            <line x1="0" y1="200" x2="400" y2="200" stroke="${color}" stroke-width="2"/>
            <line x1="100" y1="0" x2="100" y2="400" stroke="${color}" stroke-width="1"/>
            <line x1="300" y1="0" x2="300" y2="400" stroke="${color}" stroke-width="1"/>
        `,
        'random': `
            <path d="M50 100 Q 150 50 250 150 T 450 100" 
                  stroke="${color}" fill="none" stroke-width="2"/>
            <circle cx="${Math.random()*400}" cy="${Math.random()*400}" 
                    r="20" fill="${color}"/>
        `,
        'monochrome': `
            <rect width="400" height="400" fill-opacity="0.1" fill="#000"/>
            <path d="M0 0 L400 400 M0 400 L400 0" 
                  stroke="#fff" stroke-width="2"/>
        `,
        'swirl': `
            <path d="M200 200 q-50-100 0-200 q100 50 0 200" 
                  stroke="${color}" fill="none" stroke-width="2"/>
        `,
        'dots': `
            ${Array.from({length: 50}, () => 
                `<circle cx="${Math.random()*400}" cy="${Math.random()*400}" 
                         r="3" fill="${color}"/>`
            ).join('')}
        `,
        'angular': `
            <polygon points="100,100 200,50 300,100 250,200 150,200" 
                     fill="${color}"/>
        `,
        'simple': `
            <rect x="100" y="100" width="200" height="200" 
                  fill="${color}" opacity="0.5"/>
        `,
        'spray': `
            ${Array.from({length: 100}, () => 
                `<rect x="${Math.random()*400}" y="${Math.random()*400}" 
                       width="3" height="10" 
                       transform="rotate(${Math.random()*360})" 
                       fill="${color}"/>`
            ).join('')}
        `,
        'brush': `
            <path d="M50 150 Q 100 50 150 150 T 250 100 T 350 200" 
                  stroke="${color}" stroke-width="20" fill="none" 
                  stroke-linecap="round"/>
        `
    };
    return patterns[pattern] || '';
}

// Enhanced image generation with style-specific representations
function generatePlaceholderImage(prompt, style) {
    // If style is 'none', don't generate an image
    if (style === 'none') {
        imageContainer.innerHTML = '<p>No image generated</p>';
        return;
    }
    
    const styleProperties = {
        'photo': { color: '#3498db', pattern: 'linear', desc: 'Photo' },
        'abstract': { color: '#e74c3c', pattern: 'random', desc: 'Abstract' },
        'nachtwey': { color: '#2c3e50', pattern: 'monochrome', desc: 'Nachtwey' },
        'surreal': { color: '#9b59b6', pattern: 'swirl', desc: 'Surrealism' },
        'pop': { color: '#f1c40f', pattern: 'dots', desc: 'Pop Art' },
        'cubism': { color: '#e67e22', pattern: 'angular', desc: 'Cubism' },
        'minimal': { color: '#ecf0f1', pattern: 'simple', desc: 'Minimalism' },
        'street': { color: '#27ae60', pattern: 'spray', desc: 'Street Art' },
        'expressionism': { color: '#d35400', pattern: 'brush', desc: 'Expressionism'}
    };

    const {color, pattern, desc} = styleProperties[style] || {color: '#3498db', pattern: 'linear', desc: 'Default'};
    
    // Create style-specific SVG
    const svgContent = `
        <svg xmlns="http://www.w3.org/2000/svg" width="400" height="400">
            <rect width="400" height="400" fill="${color}" opacity="0.3"/>
            ${createPattern(pattern, color)}
            <text x="200" y="180" font-family="Arial" font-size="18" 
                  text-anchor="middle" fill="white">
                ${prompt.substring(0, 30)}${prompt.length > 30 ? '...' : ''}
            </text>
            <text x="200" y="220" font-family="Arial" font-size="22" 
                  text-anchor="middle" fill="white">
                Style: ${desc}
            </text>
        </svg>
    `;

    // Create a blob URL for the SVG
    const blob = new Blob([svgContent], {type: 'image/svg+xml'});
    const url = URL.createObjectURL(blob);
    
    // Display the image
    imageContainer.innerHTML = `
        <img src="${url}" alt="Generated art based on mood" class="generatedImage">
        <div class="imageInfo">
            <p>Mood: "${prompt}"</p>
            <p>Style: ${desc}</p>
        </div>
    `;
}

// Form submission handler
moodForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const mood = moodInput.value.trim();
    const style = styleSelect.value;
    
    if (mood) {
        generatePlaceholderImage(mood, style);
    } else {
        alert('Please enter your mood');
    }
});
